Sub RefreshQueryAndUpdateFilter()
    Dim ws As Worksheet
    Dim qt As QueryTable
    Dim newFilterValue As String
    Dim filterField As String
    Dim filterFormula As String

    ' Define the worksheet and QueryTable
    Set ws = ThisWorkbook.Worksheets("Sheet1")
    Set qt = ws.QueryTables(1) ' Assumes the QueryTable is the first one on the sheet

    ' Define the new filter value
    newFilterValue = "YourNewValue" ' Replace with the value to add to the filter
    filterField = "YourFilterFieldName" ' Replace with the actual column name used in the query

    ' Modify the filter
    ' Construct a filter formula for the QueryTable
    ' Example: [FilterField] IN ("Value1", "YourNewValue")
    filterFormula = "[" & filterField & "] IN ('ExistingValue', '" & newFilterValue & "')"

    ' Apply the filter (modifying the QueryTable CommandText)
    On Error Resume Next
    qt.CommandText = Replace(qt.CommandText, "OriginalFilterCondition", filterFormula)
    On Error GoTo 0

    ' Refresh the QueryTable
    qt.Refresh BackgroundQuery:=False

    ' Optional: Display a message when done
    MsgBox "QueryTable refreshed and filter updated!", vbInformation
End Sub
