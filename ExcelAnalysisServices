Sub RefreshSAPCrosstabAndAddFilter()
    Dim crosstabName As String
    Dim dimensionName As String
    Dim newFilterValue As String

    ' Define the crosstab and filter details
    crosstabName = "SAPCrosstab1"       ' Name of the Analysis Services crosstab
    dimensionName = "YourDimensionName" ' Replace with the actual dimension to filter
    newFilterValue = "YourNewValue"     ' Replace with the new value to add to the filter

    ' Refresh the crosstab
    Call Application.Run("SAPExecuteCommand", "Refresh", crosstabName)

    ' Add a new filter value
    ' Check if the filter already exists and append the new value
    Dim currentFilter As String
    currentFilter = Application.Run("SAPGetFilter", crosstabName, dimensionName)

    If InStr(currentFilter, newFilterValue) = 0 Then
        Dim updatedFilter As String
        If currentFilter = "" Then
            updatedFilter = newFilterValue
        Else
            updatedFilter = currentFilter & ";" & newFilterValue
        End If

        ' Apply the updated filter
        Call Application.Run("SAPSetFilter", crosstabName, dimensionName, updatedFilter)
    End If

    ' Optional: Notify the user
    MsgBox "SAP Crosstab refreshed and filter updated!", vbInformation
End Sub
