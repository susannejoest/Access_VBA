Sub RefreshSAPCrosstabAndAddFilter()
    Dim crosstabName As String
    Dim dimensionName As String
    Dim newFilterValue As String

    ' Define the crosstab and filter details
    crosstabName = "SAPCrosstab1"       ' Name of the Analysis Services crosstab
    dimensionName = "YourDimensionName" ' Replace with the actual dimension to filter
    newFilterValue = "YourNewValue"     ' Replace with the new value to add to the filter

    ' Refresh the crosstab
    Call Application.Run("SAPExecuteCommand", "Refresh", crosstabName)

    ' Add a new filter value
    ' Check if the filter already exists and append the new value
    Dim currentFilter As String
    currentFilter = Application.Run("SAPGetFilter", crosstabName, dimensionName)

    If InStr(currentFilter, newFilterValue) = 0 Then
        Dim updatedFilter As String
        If currentFilter = "" Then
            updatedFilter = newFilterValue
        Else
            updatedFilter = currentFilter & ";" & newFilterValue
        End If


Dimension and measure
Sub RefreshSAPCrosstabWithMeasureFilter()
    Dim crosstabName As String
    Dim measureName As String
    Dim filterCondition As String

    ' Define the crosstab and filter condition
    crosstabName = "SAPCrosstab1"        ' The name of your Analysis Services crosstab
    measureName = "YourMeasureName"      ' Replace with the name of the measure
    filterCondition = "YourCondition"   ' Replace with the condition (e.g., ">100")

    ' Construct the filter string
    Dim measureFilter As String
    measureFilter = measureName & " " & filterCondition

    ' Apply the filter via the SAP API
    On Error Resume Next
    Call Application.Run("SAPSetFilter", crosstabName, measureName, measureFilter)
    On Error GoTo 0

    ' Refresh the crosstab
    Call Application.Run("SAPExecuteCommand", "Refresh", crosstabName)

    ' Notify the user
    MsgBox "Crosstab refreshed with measure filter applied!", vbInformation
End Sub
        ' Apply the updated filter
        Call Application.Run("SAPSetFilter", crosstabName, dimensionName, updatedFilter)
    End If

    ' Optional: Notify the user
    MsgBox "SAP Crosstab refreshed and filter updated!", vbInformation
End Sub

Sub LoginToSAP()
    Dim systemName As String
    Dim username As String
    Dim password As String

    ' Set your SAP system details
    systemName = "YourSystemName" ' Replace with your SAP system name
    username = "YourUsername"    ' Replace with your SAP username
    password = "YourPassword"    ' Replace with your SAP password (ensure it's securely stored)

    ' Use the SAP API to log in
    On Error Resume Next
    Call Application.Run("SAPLogon", systemName, username, password)
    On Error GoTo 0

    ' Check if login was successful
    Dim isLoggedIn As Boolean
    isLoggedIn = Application.Run("SAPGetProperty", "IsLoggedOn")

    If isLoggedIn Then
        MsgBox "Login successful!", vbInformation
    Else
        MsgBox "Login failed. Please check your credentials or system settings.", vbCritical
    End If
End Sub
